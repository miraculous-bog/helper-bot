const { getCipherInfo, createCipheriv } = require("crypto");
const TelegramBot = require("node-telegram-bot-api");
const Token = "5226417031:AAFwZUpeQRflnyN3IuqlQxsErEkwnVJEMus";

const bot = new TelegramBot(Token, { polling: true });
let num_adm = 1;
const Users = [
  {
    id: 357629644,
    status: true,
    username: "miraculous_bog",
    state: 0,
    posting: false,
    notification: [["–ª—ñ–∫–∏", false], ["–∂–∏—Ç–ª–æ", true], ["–≤–æ–ª–æ–Ω—Ç–µ—Ä—Å—Ç–≤–æ", true], ["—ó–∂–∞", true], ["—ñ–Ω—à–µ", true]],
    temporyMsg: [],
    counterPostsSection: {
      counter: 0,
      type: undefined,
      arrayPost: undefined,
    },
  },
];

const info = {
  tab_blood: [
    "–†–µ–∫–æ–º–µ–Ω–¥—É—î–º–æ –ø–µ—Ä–µ–¥ —Ç–∏–º, —è–∫ –ø—ñ—Ç–∏ –≤ –ø—É–Ω–∫—Ç –∑–∞—Ç–µ–ª–µ—Ñ–æ–Ω—É–≤–∞—Ç–∏ –≤ –ª—ñ–∫–∞—Ä–Ω—é —ñ —É—Ç–æ—á–Ω–∏—Ç–∏ –ø—Ä–æ –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω –∫—ñ–ª—å–∫–∏–æ—Å—Ç—ñ –∫—Ä–æ–≤—ñ, –∑—Ä–æ–±–∏—Ç–∏ —Ü–µ –º–æ–∂–Ω–∞ –∑–∞—Ç–µ–ª–µ—Ñ–æ–Ω—É–≤–∞–≤—à–∏ –ª—ñ–∫–∞—Ä–Ω—ñ (–Ω–æ–º–µ—Ä –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –Ω–∞ google map)\n\n–í—ñ–Ω–Ω–∏—Ü—è \n–≤—É–ª. –ü–∏—Ä–æ–≥–æ–≤–∞, 48\n\n–Ü–ª–ª—ñ–Ω—Ü—ñ\n–≤—É–ª. –ï–Ω–≥–µ–ª—å—Å–∞, 48\n\n–ì–∞–π—Å–∏–Ω\n–≤—É–ª. –ì—É—Ä–≤–∏—á–∞, 1\n\n–Ø–º–ø—ñ–ª—å\n–≤—É–ª. –ü–∏—Ä–æ–≥–æ–≤–∞, 1\n\n –ú–æ–≥–∏–ª—ñ–≤-–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π\n–≤—É–ª. –ü–æ–ª—Ç–∞–≤—Å—å–∫–∞, 89/2\n\n–®–∞—Ä–≥–æ—Ä–æ–¥\n–≤—É–ª. –ü–∞—Ä—Ö–æ–º–µ–Ω–∫–æ, 9\n\n–ë–∞—Ä\n–≤—É–ª. –†–æ–∑–∏ –õ—é–∫—Å–µ–º–±—É—Ä–≥, 34\n\n–ë–µ—Ä—à–∞–¥—å\n–≤—É–ª. –ë—É–¥–∫–µ–≤–∏—á–∞, 2",
  ],
  tab_point: [""],
};
const typeDinamicPost = ["–ª—ñ–∫–∏", "–∂–∏—Ç–ª–æ", "–≤–æ–ª–æ–Ω—Ç–µ—Ä—Å—Ç–≤–æ", "—ó–∂–∞", "—ñ–Ω—à–µ"];
const dinamickPost = [
  {
    content: {
      type: 'text',
      content: 'pills',
      caption: '#–ø—Ä–æ–ø–æ–Ω—É—é_–ª—ñ–∫–∏\n\npills'
    },
    type: '–ª—ñ–∫–∏',
    msgId: 4651,
    userInfo: { username: undefined, name: 'Miraculous', id: 357629644 },
    main: false
  },
  {
    content: {
      type: 'text',
      content: 'home',
      caption: '#–ø–æ—Ç—Ä–µ–±—É—é_–∂–∏—Ç–ª–æ\n\nhome'
    },
    type: '–∂–∏—Ç–ª–æ',
    msgId: 4658,
    userInfo: { username: undefined, name: 'Miraculous', id: 357629644 },
    main: false
  }
  //   {
  //     content: { type: 'text', content: '1======', caption: '1======' },
  //     type: 'requestShelter',
  //     msgId: 2011,
  //     userInfo: { username: 'miraculous_bog', name: 'Miraculous', id: 357629644 },
  //     main: false
  //   },
  //   {
  //     content: { type: 'text', content: '2----------', caption: '2----------' },
  //     type: 'requestShelter',
  //     msgId: 2015,
  //     userInfo: { username: 'miraculous_bog', name: 'Miraculous', id: 357629644 },
  //     main: false
  //   },
  //   {
  //     content: { type: 'text', content: '3===========', caption: '3===========' },
  //     type: 'requestShelter',
  //     msgId: 2019,
  //     userInfo: { username: 'miraculous_bog', name: 'Miraculous', id: 357629644 },
  //     main: false
  //   },
  //   {
  //     content: { type: 'text', content: '4========', caption: '4========' },
  //     type: 'requestShelter',
  //     msgId: 2023,
  //     userInfo: { username: 'miraculous_bog', name: 'Miraculous', id: 357629644 },
  //     main: false
  //   },
  //   {
  //     content: { type: 'text', content: '5======', caption: '5======' },
  //     type: 'requestShelter',
  //     msgId: 2028,
  //     userInfo: { username: 'miraculous_bog', name: 'Miraculous', id: 357629644 },
  //     main: false
  //   },
  //   {
  //     content: { type: 'text', content: '6====', caption: '6====' },
  //     type: 'requestShelter',
  //     msgId: 2032,
  //     userInfo: { username: 'miraculous_bog', name: 'Miraculous', id: 357629644 },
  //     main: false
  //   },
  //   {
  //     content: { type: 'text', content: '7=========', caption: '7=========' },
  //     type: 'requestShelter',
  //     msgId: 2036,
  //     userInfo: { username: 'miraculous_bog', name: 'Miraculous', id: 357629644 },
  //     main: false
  //   },
  //   {
  //     content: {
  //       type: 'text',
  //       content: '8============',
  //       caption: '8============'
  //     },
  //     type: 'requestShelter',
  //     msgId: 2040,
  //     userInfo: { username: 'miraculous_bog', name: 'Miraculous', id: 357629644 },
  //     main: false
  //   },
  //   {
  //     content: { type: 'text', content: '9======', caption: '9======' },
  //     type: 'requestShelter',
  //     msgId: 2044,
  //     userInfo: { username: 'miraculous_bog', name: 'Miraculous', id: 357629644 },
  //     main: false
  //   },
  //   {
  //     content: { type: 'text', content: '10====', caption: '10====' },
  //     type: 'requestShelter',
  //     msgId: 2048,
  //     userInfo: { username: 'miraculous_bog', name: 'Miraculous', id: 357629644 },
  //     main: false
  //   }
  //   ,
  //   {
  //     content: { type: 'text', content: '11====', caption: '11====' },
  //     type: 'requestShelter',
  //     msgId: 2056,
  //     userInfo: { username: 'miraculous_bog', name: 'Miraculous', id: 357629644 },
  //     main: false
  //   }
];

const typeStaticPost = [];
const staticPost = [];

// let temporyMsg = [];
const getChatId = (msg) => {
  return msg.chat.id;
};

const getPostBoard = (chatId) => {
  bot.sendMessage(chatId, `üìÉ–ó—Ä–æ–±–∏—Ç–∏ —Ç–∞ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó –ø—Ä–æ –¥–æ–ø–æ–º–æ–≥—É –∞–±–æ –∑–∞–ø—Ä–æ–ø–æ–≤–Ω—É–≤–∞—Ç–∏ —ó—ó.

  –í–∏ –º–æ–∂–µ—Ç–µ –∑–∞–ø—Ä–æ–ø–æ–Ω—É–≤–∞—Ç–∏/–∑–Ω–∞–π—Ç–∏ –¥–æ–ø–æ–º–æ–≥—É –ø–æ —Ç–∞–∫–∏–º –ø—É–Ω–∫—Ç–∞–º —è–∫ :
  
  üíÅ‚Äç‚ôÇÔ∏è–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ü—Ä–æ–ø–æ–Ω—É—é" - —è–∫—â–æ –≤–∏ –±–∞–∂–∞—î—Ç–µ –∑–∞–ø—Ä–æ–ø–æ–Ω—É–≤–∞—Ç–∏ —Å–≤–æ—é –¥–æ–ø–æ–º–æ–≥—É.
  üôã‚Äç‚ôÇÔ∏è–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ü–æ—Ç—Ä–µ–±—É—é" - —è–∫—â–æ –≤–∏ –±–∞–∂–∞—î—Ç–µ –æ–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ –ø–æ—Å—Ç –ø—Ä–æ –Ω–∞–¥–∞–Ω–Ω—è –≤–∞–º –¥–æ–ø–æ–º–æ–≥–∏.
  üìã–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–°–ø–∏—Å–æ–∫ –ø—Ä–æ–ø–æ–Ω—É—é—á–∏—Ö —Ç–∞ –ø–æ—Ç—Ä–µ–±—É—é—á–∏—Ö –¥–æ–ø–æ–º–æ–≥–∏" - —è–∫—â–æ –≤–∏ –±–∞–∂–∞—î—Ç–µ –ø—Ä–æ–¥–∏–≤–∏—Ç–∏—Å—è —Å–ø–∏—Å–æ–∫ —É—Å—ñ—Ö –ø–æ—Å—Ç—ñ–≤ —Ç–∞ –∑–Ω–∞–π—Ç–∏ —à–æ—Å—å –¥–ª—è —Å–µ–±–µ.`, {
    reply_markup: {
      inline_keyboard: [
        // [
        //   {
        //     text: "show users",
        //     callback_data: "show_users",
        //   },
        // ],
        [
          {
            text: "üíÅ‚Äç‚ôÇÔ∏è–ü—Ä–æ–ø–æ–Ω—É—é",
            callback_data: "offer",
          },
          {
            text: "üôã‚Äç‚ôÇÔ∏è–ü–æ—Ç—Ä–µ–±—É—é",
            callback_data: "need",
          },
        ],
        [
          {
            text: "üìã–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Å–ø–∏—Å–æ–∫ –ø–æ—Å—Ç—ñ–≤ –¥–æ–ø–æ–º–æ–≥–∏",
            callback_data: "look_list",
          },
        ],
      ],
    },
  });
};
const showKeyboard = (chatId) => {
  // console.log('keyyyyyboard');
  const allArraysOfBtns = typeStaticPost.map((item) => {
    return [
      {
        text: item,
        callback_data: item,
      },
    ];
  });

  // console.log("allArraysOfBtns", allArraysOfBtns);
  bot.sendMessage(chatId, "–¢—É—Ç –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –Ω–∞–π–∞–∫—Ç—É–∞–ª—å–Ω—ñ—à—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, —è–∫–∞ –¥–æ–ø–æ–º–æ–∂–µ –≤–∞–º –ø—ñ–¥ —á–∞—Å –≤—ñ–π–Ω–∏. –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø–æ—Å—Ç—ñ–π–Ω–æ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è. –¶–µ —Å—Ç–∞—Ç–∏—á–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è, —è–∫–∞ –º–æ–∂–µ –º—ñ—Å—Ç–∏—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —ñ–Ω—à—ñ –¥–∂–µ—Ä–µ–ª–∞.", {
    reply_markup: {
      inline_keyboard: [

        ...allArraysOfBtns,
      ],
    },
  });
};

const getIntro = () => {
  return {
    reply_markup: {
      inline_keyboard: [
        [
          {
            text: "–û–∑–Ω–∞–π–æ–º–∏—Ç–∏—Å—è",
            callback_data: "intro",
          },
        ],
      ],
    },
  };
};
const getMenuBtn = () => {
  return {
    reply_markup: {
      inline_keyboard: [
        [
          {
            text: "–†–æ–∑–¥—ñ–ª–∏",
            callback_data: "menu",
          },
        ],
      ],
    },
  };
};
const getBasicMenu = (id, additionInfo = '') => {
  bot.sendMessage(id, `${additionInfo}\n–í–∞—à—ñ —Ä–æ–∑–¥—ñ–ª–∏:`, {
    reply_markup: {
      inline_keyboard: [
        [
          {
            text: "üìÉ–ü–æ—Å—Ç–∏/–ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó –¥–æ–ø–æ–º–æ–≥–∏",
            callback_data: "posts",
          },
          {
            text: "‚ÑπÔ∏è–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –Ω–∞ –≤—Å—ñ –≤–∏–ø–∞–¥–∫–∏",
            callback_data: "allInfo",
          },
        ],
        [
          {
            text: "üîî–ö–µ—Ä—É–≤–∞–Ω–Ω—è –æ–ø–æ–≤—ñ—â–µ–Ω–Ω—è–º–∏",
            callback_data: "controlNotification",
          },
          {
            text: "üì§–ú–æ—ó –ø–æ—Å—Ç–∏",
            callback_data: "myPosts",
          },
        ],
      ],
    },
  });
}
function sendingWrittenPost(msg) {
  const user = getUser(msg);
  // console.log("tmps", temporyMsg[1]);
  console.log("223 sendingWrittenPostFC", user.temporyMsg);
  if (user.temporyMsg[1].type === "text") {

    bot.sendMessage(getChatId(msg), msg.text, {
      reply_markup: {
        inline_keyboard: [
          [
            {
              text: "‚ùå–í—ñ–¥–º—ñ–Ω–∞",
              callback_data: "deny",
            },
            {
              text: "ü™Ñ–†–µ–¥–∞–≥—É–≤–∞—Ç–∏",
              callback_data: "edit",
            },
            {
              text: "‚úÖ–≥–æ—Ç–æ–≤–æ",
              callback_data: "ready",
            },
          ],
        ],
      },
    });
  } else if (user.temporyMsg[1].type === "video") {
    bot.sendVideo(getChatId(msg), msg.video.file_id, msg.caption, {
      reply_markup: {
        inline_keyboard: [
          [
            {
              text: "‚ùå–í—ñ–¥–º—ñ–Ω–∞",
              callback_data: "deny",
            },
            {
              text: "ü™Ñ–†–µ–¥–∞–≥—É–≤–∞—Ç–∏",
              callback_data: "edit",
            },
            {
              text: "‚úÖ–≥–æ—Ç–æ–≤–æ",
              callback_data: "ready",
            },
          ],
        ],
      },
    });
  } else if (user.temporyMsg[1].type === "photo") {
    bot.sendPhoto(getChatId(msg), msg.photo[0].file_id);
    bot.sendMessage(getChatId(msg), msg.caption, {
      reply_markup: {
        inline_keyboard: [
          [
            {
              text: "‚ùå–í—ñ–¥–º—ñ–Ω–∞",
              callback_data: "deny",
            },
            {
              text: "ü™Ñ–†–µ–¥–∞–≥—É–≤–∞—Ç–∏",
              callback_data: "edit",
            },
            {
              text: "‚úÖ–≥–æ—Ç–æ–≤–æ",
              callback_data: "ready",
            },
          ],
        ],
      },
    });
  }
}

const sendMsg = function (msg, text) {
  bot.sendMessage(getChatId(msg), text);
};

const getUser = (msg) => Users.find((user) => user.id === msg.chat.id);

const getUserById = (id) => Users.find((user) => user.id === id);

const getStaticPostById = (id) => staticPost.find((post) => post.msgId === id);

const getStaticType = (title) => typeStaticPost.find((name) => name === title);

const getDinamicPostById = (id) => dinamickPost.find((post) => post.msgId === id);

const isAdmin = (msg) =>
  Users.find((admin) => admin.id === msg.chat.id && admin.status === true);

const deletePost = (id, postId) => {

  // console.log("postId!", user.id, postId);
  // console.log(getStaticPostById(currentText));
  const positionCurrentEl = dinamickPost.indexOf(getDinamicPostById(postId));


  // console.log(staticPost, positionCurrentEl);
  dinamickPost.splice(positionCurrentEl, 1);
  // console.log(staticPost);
  // Users.forEach((user) => {
  //   bot.sendMessage();
  // });
  bot.sendMessage(id, `–ü–æ—Å—Ç ‚Ññ${postId} –±—É–≤ –≤–∏–¥–∞–ª–µ–Ω–∏–π`);
};

const sendAllTypesMsg = (post, id, btn = null, info = null) => {
  // console.log("BTN HERE", btn);
  // console.log("INFO", info);

  let text = post.caption;

  // console.log(isAdmin({ chat: { id: id } }));
  // console.log(post, id, info);
  if (isAdmin({ chat: { id: id } }) && info !== null) {
    // console.log("yaaaaaaaaaaaaaaaaaaaa");
    text += `\n--------------------------\n`
    text += `—ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ${info.name}\n`;
    text += `username –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ @${info.username}\n`;
    text += `id –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ${info.id}\n`;
    text += `id –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è ${info.msgId}`;
    // console.log(info);
  }

  // console.log("TEXT", text);
  let parseBtn = null;
  if (btn !== null) {
    // console.log("BTN HERE");
    parseBtn = {
      reply_markup: {
        inline_keyboard: [
          [
            {
              text: `–í–∏–¥–∞–ª–∏—Ç–∏`,
              callback_data: `delete${btn}`,
            },
          ],
        ],
      },
    };
  }

  if (post.type === "text") {
    btn !== null
      ? bot.sendMessage(id, text, parseBtn)
      : bot.sendMessage(id, text);
  } else if (post.type === "video") {
    if (btn !== null) {
      bot.sendVideo(id, post.content);
      bot.sendMessage(id, text, parseBtn);
    } else {
      bot.sendVideo(id, post.content);
      bot.sendMessage(id, text);
    }
  } else if (post.type === "photo") {
    if (btn !== null) {
      bot.sendPhoto(id, post.content);
      bot.sendMessage(id, text, parseBtn);
    } else {
      bot.sendPhoto(id, post.content);
      bot.sendMessage(id, text);
    }
  }
};
const isTurnUserNotif = (arrOfControler, type) => {
  const controler = arrOfControler.find(el => el[0] === type);
  console.log(controler);
  if (controler[1]) {
    return true;
  } else {
    return false;
  }
}
const sendPost = (type, content, id) => {
  console.log("sendPostsendPostsendPostsendPost—î—î—î—î—î—î—î—î—î");
  Users.forEach((user) => {
    // isTurnUserNotif(user.notification, type) ? 'yee' : 'noo';
    // user.id !== id ? 'yeee' : 'noo';
    if (isTurnUserNotif(user.notification, type) && user.id !== id) {
      console.log('cooooooo', content, user.id);
      sendAllTypesMsg(content, user.id);
    }
  });
};

const getTypeFile = (msg) => {
  if (msg.text) {
    return { type: "text", content: msg.text, caption: msg.text };
  } else if (msg.video) {
    return { type: "video", content: msg.video.file_id, caption: msg.caption };
  } else if (msg.photo) {
    return {
      type: "photo",
      content: msg.photo[0].file_id,
      caption: msg.caption,
    };
  }
};


const sendSepSectionPost = (id, user) => {
  // console.log('3outputPosts=================');
  bot.sendMessage(id, "–î–∞–ª—ñ...", {
    reply_markup: {
      inline_keyboard: [
        [
          {
            text: `${user.counterPostsSection.counter} / ${user.counterPostsSection.arrayPost.length}>>>`,
            callback_data: "next",
          },
        ],
        [
          {
            text: "–†–æ–∑–¥—ñ–ª–∏",
            callback_data: "menu",
          },
        ],
      ],
    },
  })
};

const outputPosts = (id, user) => {
  // console.log(counterPostsSection);
  console.log('outputPosts=================');
  const mainPost = dinamickPost.filter(post => post.main === true && post.type === user.counterPostsSection.type);
  const noMainPost = dinamickPost.filter(post => post.main === false && post.type === user.counterPostsSection.type);
  // console.log(mainPost, noMainPost);
  user.counterPostsSection.arrayPost = [...noMainPost];
  // console.log(counterPostsSection.arrayPost, "........", noMainPost);
  mainPost.forEach(post => setTimeout(sendAllTypesMsg, 1000, post.content, id));
  console.log('2outputPosts=================');
  setTimeout(sendSepSectionPost, 2000, id, user);
};

bot.on("message", (msg) => {
  const user = getUser(msg);
  if (msg.text !== undefined) {
    // console.log(msg);
    if (msg.text[0] === "/") return;
  }
  if (user.status === null) return;
  console.log("461 onMSG", user.temporyMsg);
  user.temporyMsg[1] = getTypeFile(msg);

  if (getUser(msg).state !== 0) sendingWrittenPost(msg);
});
const doCommandAction = (command, posting, msg) => {
  const text = `üìÉ–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ—Å—Ç —Å—Ç–æ—Å–æ–≤–Ω–æ —Ä–æ–∑–¥—ñ–ª—É ${command}.
  –ù–∞–ø–∏—à—ñ—Ç—å —Ç–µ–∫—Å—Ç–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤–∞—à–æ–≥–æ –∑–∞–ø–∏—Ç—É –∞–±–æ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó.
  ‚ùï–í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ –æ–¥–Ω—É –∫–∞—Ä—Ç–∏–Ω–∫—É –∞–±–æ –≤—ñ–¥–µ–æ, —Ç–∞ –¥–æ–¥–∞—Ç–∏ –æ–ø–∏—Å –¥–ª—è –Ω–µ—ó. –í—Å—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–¥–Ω–∏–º –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º.
  ‚ùóÔ∏è–û–±–æ–≤'—è–∑–∫–æ–≤–æ –¥–æ–¥–∞–π—Ç–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, —è–∫–∞ –¥–∞—Å—Ç—å –∑–º–æ–≥—É –∑–≤'—è–∑–∞—Ç–∏—Å—è –∑ –≤–∞–º–∏.
   ‚úÖ–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –±–æ—Ç –¥–æ–¥–∞—î –≤–∞—à –Ω—ñ–∫–Ω–µ–π–º –∑ —Ç–µ–ª–µ–≥—Ä–∞–º—É, —è–∫—â–æ –≤—ñ–Ω —É –≤–∞—Å –Ω–∞—è–≤–Ω–∏–π, –∞ —Ç–∞–∫–æ–∂ —Ö–µ—à—Ç–µ–≥.`;
  sendMsg(msg, text);
  const user = getUser(msg);
  console.log("469 doCommandActionFC", user.temporyMsg);
  user.state = 1;
  user.posting = posting;
  user.temporyMsg[0] = command;
};

const transformDeleteData = (data) => {
  let strData = data.split("");
  let removed = strData.splice(0, 6);
  return [removed.join(""), strData.join("")];
};

const getTypeAndContent = (content) => {
  const splitedContent = content.split("`");
  return [splitedContent[0], splitedContent[1]];
};

const getLengthOfDinamicType = (type) => {
  const howManyCurrentType = dinamickPost.filter(el => el.type === type);
  return howManyCurrentType.length;
}

const getTypeDinamic = (type) => {
  const arrOfBtnType = [];
  let counterFiled = 0;
  let cunterArrFiled = [];
  for (let i = 0; i < typeDinamicPost.length; i++) {

    if ((counterFiled % 3) === 0) {
      arrOfBtnType.push(cunterArrFiled);
      cunterArrFiled = [];
    }

    cunterArrFiled.push({ text: `${typeDinamicPost[i]} ${getLengthOfDinamicType(typeDinamicPost[i])}—à—Ç.`, callback_data: `${type}_${typeDinamicPost[i]}` });
    // console.log("cunterArrFiled", cunterArrFiled);
    counterFiled++;
    if (i === typeDinamicPost.length - 1) {
      arrOfBtnType.push(cunterArrFiled);
      console.log('arrOfBtnType', arrOfBtnType);
      return arrOfBtnType;
    }
  }

  return arrOfBtnType;
}
// üîîüîï
// üü¢üî¥
const getTagNot = (state) => state ? 'üîî' : 'üîï';
const getTypeDinamicForNotification = (type, id) => {
  const userNot = getUserById(id).notification;
  const arrOfBtnType = [];
  let counterFiled = 0;
  let cunterArrFiled = [];
  for (let i = 0; i < userNot.length; i++) {

    if ((counterFiled % 3) === 0) {
      arrOfBtnType.push(cunterArrFiled);
      cunterArrFiled = [];
    }

    cunterArrFiled.push({ text: `${userNot[i][0]} ${getTagNot(userNot[i][1])}`, callback_data: `${type}_${userNot[i][0]}` });
    // console.log("cunterArrFiled", cunterArrFiled);
    counterFiled++;
    if (i === userNot.length - 1) {
      arrOfBtnType.push(cunterArrFiled);
      return arrOfBtnType;
    }
  }
  return arrOfBtnType;
}
const getMsg = (query) => {
  const id = getChatId(query.message);
  const user = getUser(query.message);
  const deletedBtn = transformDeleteData(query.data);

  if (deletedBtn[0] === "delete") {
    deletePost(id, Number(deletedBtn[1]));
    // deletePost(Number(deletedBtn[1]) + 2);
    return;
  }
  if (typeStaticPost.includes(query.data)) {
    staticPost.forEach((post) => {
      if (post.type === query.data) {
        const infoUserObj = { ...post.userInfo };
        infoUserObj.msgId = post.msgId;
        sendAllTypesMsg(post.content, id, null, infoUserObj);
      }
    });
  }
  if (query.data.includes("needing")) {
    // console.log("yeeeeeeeeeeeeeeeeeessss")
    const dataOfDinamicType = query.data.split("_")[1];
    doCommandAction(dataOfDinamicType, `#–ø–æ—Ç—Ä–µ–±—É—é_${dataOfDinamicType}\n\n`, query.message);
  } else if (query.data.includes("offering")) {
    // console.log("yeeeeeeeeeeeeeeeeeessss")
    const dataOfDinamicType = query.data.split("_")[1];
    doCommandAction(dataOfDinamicType, `#–ø—Ä–æ–ø–æ–Ω—É—é_${dataOfDinamicType}\n\n`, query.message);
  } else if (query.data.includes("showing")) {
    console.log("showingggggggggggggggg", user);
    user.counterPostsSection.counter = 0;
    console.log("showingggggggggggggggg", user);
    user.counterPostsSection.type = query.data.split("_")[1];
    user.counterPostsSection.arrayPost = undefined;
    outputPosts(getChatId(query.message), user);
  } else if (query.data.includes("turnNotif")) {
    // console.log('turnNotif turnNotif turnNotif turnNotif');
    const typeForChangeStateNotif = query.data.split("_")[1];
    const currentChangeTypeNotif = user.notification.find(notif => notif[0] === typeForChangeStateNotif);
    const indexElement = user.notification.indexOf(currentChangeTypeNotif);
    if (user.notification[indexElement][1]) {
      user.notification[indexElement][1] = false;
      bot.sendMessage(id, `–¢–µ–ø–µ—Ä –≤–∞–º –Ω–µ –±—É–¥—É—Ç—å –Ω–∞–¥—Å–∏–ª–∞—Ç–∏—Å—è –ø–æ—Å—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó ${user.notification[indexElement][0]} üîî -> üîï`);
    } else {
      user.notification[indexElement][1] = true;
      bot.sendMessage(id, `–¢–µ–ø–µ—Ä –≤–∞–º –±—É–¥—É—Ç—å –Ω–∞–¥—Å–∏–ª–∞—Ç–∏—Å—è –ø–æ—Å—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó ${user.notification[indexElement][0]} üîï -> üîî`);
    }
  }

  switch (query.data) {
    case "show_users":
      console.log(
        "-----",
        typeDinamicPost,
        typeStaticPost,
        "-----",
        staticPost,
        "-----",
        dinamickPost,
        "-----",
        Users
      );
      break;
    case "next":








      // console.log("neeext seccuess====");
      let Action = false;
      const getSituableAction = (isDo) => {

        if (isDo) {
          // console.log('isDoiiing');
          // bot.sendMessage(getChatId(query.message), "–í–∞—à—ñ —Ä–æ–∑–¥—ñ–ª–∏ —Ç—É—Ç—å üëá", getMenuBtn());
        } else {
          sendSepSectionPost(getChatId(query.message), user);
        }
      }
      let iter = 3;
      if (user.counterPostsSection.counter + iter >= user.counterPostsSection.arrayPost.length) {
        iter = user.counterPostsSection.arrayPost.length - user.counterPostsSection.counter;
        Action = true;
        // console.log("YEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE");
      }
      // console.log("neeext seccuess====");
      let iteration = user.counterPostsSection.counter + iter;
      // console.log(iteration);
      // console.log("iteer anhd counterPostsSection", counterPostsSection.counter, iter);
      const newId = getChatId(query.message);
      for (let i = user.counterPostsSection.counter; i < iteration; i++) {
        // console.log(i);
        const infoUserObj = { ...user.counterPostsSection.arrayPost[i].userInfo };
        infoUserObj.msgId = user.counterPostsSection.arrayPost[i].msgId;
        setTimeout(sendAllTypesMsg, 1000, user.counterPostsSection.arrayPost[i].content, newId, null, infoUserObj);
      }
      // console.log("iteer anhd counterPostsSection", counterPostsSection.counter, iter);
      user.counterPostsSection.counter += iter;
      // console.log("iteer anhd counterPostsSection", counterPostsSection.counter, iter);

      setTimeout(getSituableAction, 5000, Action);







      break;
    case "need":
      // console.log("getTypeDinamic", getTypeDinamic());
      bot.sendMessage(id, "–í–∏–±–µ—Ä—ñ—Ç—å –±–∞–∂–∞–Ω—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é:", {
        reply_markup: {
          inline_keyboard: getTypeDinamic("needing")
        }
      });
      break;
    case "offer":
      // console.log("getTypeDinamic", getTypeDinamic());
      bot.sendMessage(id, "–í–∏–±–µ—Ä—ñ—Ç—å –±–∞–∂–∞–Ω—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é:", {
        reply_markup: {
          inline_keyboard: getTypeDinamic("offering")
        }
      });
      break;
    case "look_list":
      console.log("getTypeDinamic");
      bot.sendMessage(id, "–í–∏–±–µ—Ä—ñ—Ç—å –±–∞–∂–∞–Ω—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é:", {
        reply_markup: {
          inline_keyboard: getTypeDinamic("showing")
        }
      });
      break;
    case "controlNotification":
      bot.sendMessage(id, "–í–∏–±–µ—Ä—ñ—Ç—å –±–∞–∂–∞–Ω—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é:", {
        reply_markup: {
          inline_keyboard: getTypeDinamicForNotification("turnNotif", id)
        }
      });
      break;
    case "menu":
      // bot.sendMessage(id, `–í–∞—à—ñ —Ä–æ–∑–¥—ñ–ª–∏ —Ç—É—Ç—å üëá`, getBasicMenu(id));
      getBasicMenu(id);
      break;
    case "intro":
      getPostBoard(id);
      showKeyboard(id);
      // bot.sendMessage(id, "–†–æ–∑–¥—ñ–ª–∏", showKeyboard(getChatId(msg)));
      break;
    case "posts":
      getPostBoard(id);
      break;
    case "allInfo":
      showKeyboard(id);
      break;
    case "myPosts":
      console.log("MyPooostss");
      let i = 1
      dinamickPost.forEach(myPost => {
        console.log(myPost);
        if (myPost.userInfo.id === id) {
          console.log("true")
          let innerContent = {
            type: myPost.content.type,
            content: myPost.content.content,
            caption: myPost.content.caption,
          }
          // console.log("========", caption, myPost.caption);
          innerContent.caption += `\n–ö–∞—Ç–µ–≥–æ—Ä—ñ—è: ${myPost.type}`
          innerContent.caption += `\nId –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: ${myPost.msgId}`
          innerContent.caption += `\n–í–∞—à–∞ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—è ‚Ññ${i}`
          console.log(innerContent, id, myPost.msgId);
          console.log(myPost, id, myPost.msgId);
          setTimeout(sendAllTypesMsg, 1000, innerContent, id, myPost.msgId)
          // sendAllTypesMsg(myPost.content, id, myPost.msgId);
          i++;
        }
      });
      i = 0;
      bot.sendMessage(id, "–í–∞—à—ñ —Ä–æ–∑–¥—ñ–ª–∏ —Ç—É—Ç—å üëá", getMenuBtn());
      break;
    case "edit":
      bot.sendMessage(id, "–í–≤–µ–¥—ñ—Ç—å –Ω–æ–≤—É –∞–±–æ –≤—ñ–¥—Ä–µ–¥–∞–≥–æ–≤–∞–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é");
      break;
    case "deny":
      bot.sendMessage(id, "–≤–∏ –≤—ñ–¥–º—ñ–Ω–∏–ª–∏ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—é");
      //   console.log(query);
      user.state = 0;
      user.posting = false;
      break;
    case "ready":
      // bot.sendMessage(id, temporyMsg);
      console.log("----------------");
      console.log("user 732", user);
      if (user.state == 2) {
        user.state = 0;
        // console.log("2");

        // user.posting[`${temporyMsg[0]}`] = false;
        // console.log("3");
        const getMetaData = getTypeAndContent(user.temporyMsg[1].caption);

        user.temporyMsg[0] = getMetaData[0];
        user.temporyMsg[1].caption = getMetaData[1];
        if (!typeStaticPost.includes(user.temporyMsg[0])) {
          typeStaticPost.push(user.temporyMsg[0]);
        }
        // console.log("query.message_______________++++++++", query.message);
        console.log("714 ", user.temporyMsg);
        staticPost.push({
          content: user.temporyMsg[1],
          type: user.temporyMsg[0],
          msgId: query.message.message_id,
          userInfo: {
            username: query.message.chat.username,
            name: query.message.chat.first_name,
            id: query.message.chat.id,
          },
        });
        // sendPost(user.temporyMsg[0], user.temporyMsg[1], id);
        Users.forEach(user => {
          bot.sendMessage(user.id, `–î–æ–¥–∞–Ω–∞ –Ω–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –Ω–∞ —Ç–µ–º—É "${user.temporyMsg[0]}". –î–ª—è —Ç–æ–≥–æ –∞–±–∏ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å "–†–æ–∑–¥—ñ–ª–∏" -> "–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –Ω–∞ –≤—Å—ñ –≤–∏–ø–∞–¥–∫–∏"`);
        })
        // console.log("great");
        // sendAllTypesMsg(user.temporyMsg[1], id, query.message.message_id);
      } else if (user.state == 1) {
        user.state = 0;
        console.log("----------------", user);
        // console.log("2");
        console.log("user 732", user);
        console.log("732 ", user.temporyMsg);
        let textInfo = user.posting;
        textInfo += user.temporyMsg[1].caption;
        if (query.message.chat.username !== undefined) {
          textInfo += `\n\n–ó–∞ –¥–µ—Ç–∞–ª—è–º–∏ –∑–≤–µ—Ä—Ç–∞—Ç–∏—Å—è –¥–æ @${query.message.chat.username}`
        }
        user.temporyMsg[1].caption = textInfo;

        dinamickPost.push({
          content: user.temporyMsg[1],
          type: user.temporyMsg[0],
          msgId: query.message.message_id,
          userInfo: {
            username: query.message.chat.username,
            name: query.message.chat.first_name,
            id: query.message.chat.id,
          },
          main: false,
        });
        user.posting = false;
        const textSuccess = `–í–∞—à –ø–æ—Å—Ç —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–∏–π —Ç–∞ –æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–∏–π. ‚úÖ
        –í–∏ –º–æ–∂–µ—Ç–µ –π–æ–≥–æ –≤–∏–¥–∞–ª–∏—Ç–∏.
        –í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å—ñ –≤–∞—à—ñ –ø–æ—Å—Ç–∏ —Å–∫–æ—Ä–∏—Å—Ç–∞–≤—à–∏—Å—å: "–†–æ–∑–¥—ñ–ª–∏" -> "–ú–æ—ó –ø–æ—Å—Ç–∏".`;
        bot.sendMessage(getChatId(query.message), textSuccess);
        // console.log("–í–∞—à–∏–π –ø–æ—Å—Ç —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–∏–π");
        // console.log()
        sendAllTypesMsg(user.temporyMsg[1], id, query.message.message_id, null);
        sendPost(user.temporyMsg[0], user.temporyMsg[1], id);
        bot.sendMessage(id, "–í–∞—à—ñ —Ä–æ–∑–¥—ñ–ª–∏ —Ç—É—Ç—å üëá", getMenuBtn());
      }
  }
};

bot.onText(/\/start/, (msg) => {
  console.log('staaaaaaaart');
  const userId = msg.from.id;
  const text1 = `üî∞–î–ª—è –ø–æ—á–∞—Ç–∫—É —Ä–æ–±–æ—Ç–∏ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å "–û–∑–Ω–∞–π–æ–º–∏—Ç–∏—Å—è".
`;
  const text2 = `–î–ª—è —Ç–æ–≥–æ, –∞–±–∏ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó —ñ–Ω—à–∏—Ö —â–æ–¥–æ –¥–æ–ø–æ–º–æ–≥–∏ –∞–±–æ —ó—ó –Ω–∞–¥–∞–Ω–Ω—è: 

üîéüè°–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–Ü—Å–Ω—É—é—á—ñ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó –∂–∏—Ç–ª–∞"
üîé‚ù§Ô∏è‚Äçü©π–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–Ü—Å–Ω—É—é—á—ñ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó –≤–æ–ª–æ–Ω—Ç–µ—Ä—Å–≤–∞"`;
  // console.log(userId);
  // console.log(isExist);
  // console.log(Users);
  // console.log('staaaaaaaart');
  const isExist = Users.find((item) => item.id === userId);

  !isExist
    ? Users.push({
      id: msg.from.id,
      username: msg.from.username,
      status: false,
      state: 0,
      posting: false,
      notification: [["–ª—ñ–∫–∏", true], ["–∂–∏—Ç–ª–æ", true], ["–≤–æ–ª–æ–Ω—Ç–µ—Ä—Å—Ç–≤–æ", true], ["—ó–∂–∞", true], ["—ñ–Ω—à–µ", true]],
      temporyMsg: [],
      counterPostsSection: {
        counter: 0,
        type: undefined,
        arrayPost: undefined,
      },
    })
    : null;

  bot.sendMessage(getChatId(msg), text1);
  // bot.sendMessage(getChatId(msg), text2);
  // bot.sendMessage(getChatId(msg), text2);
  // bot.sendMessage(getChatId(msg), text2);
  bot.sendMessage(getChatId(msg), "üëá", getIntro());

  // getMenuBtn();
});

bot.on("callback_query", (query) => {
  getMsg(query);
});



bot.onText(/\/addPost/, (msg) => {
  if (isAdmin(msg)) {
    getUser(msg).state = 2;
    bot.sendMessage(
      getChatId(msg),
      "–í—ñ—Ç–∞—é —à–∞–Ω–æ–≤–Ω–∏–π –∞–¥–º—ñ–Ω, –Ω–∞–ø–∏—à—ñ—Ç—å –≤–∞—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —É —Ñ–æ—Ä–º–∞—Ç—ñ: –Ω–∞–∑–≤–∞ —Ä–æ–∑–¥—ñ–ª—É`–Ω–∞–ø–æ–≤–Ω–µ–Ω–Ω—è"
    );
  }
});

bot.onText(/\/turnAdmin (.+)/, (msg, source, match) => {
  const currentText = Number(source[1]);
  // console.log(currentText);
  if (isAdmin(msg)) {
    // console.log("before user");
    const user = getUserById(currentText);
    // console.log(user);
    if (user.status === false) {
      user.status = true;
      bot.sendMessage(currentText, `–í—ñ—Ç–∞—é! –¢–∏ –∞–¥–º—ñ–Ω.
      –¢–≤–æ—ó –∫–æ–º–∞–Ω–¥–∏:
      –£–≤–∞–≥–∞! –í—Å—ñ –∫–æ–º–∞–Ω–¥–∏, —è–∫—ñ –º–∞—é—Ç—å –ø–æ–∑–Ω–∞—á–∫—É ‚ùóÔ∏è, –¥–æ–¥–∞—é—Ç—å—Å—è –ª–∏—à–µ –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º –ø–æ–≥–æ–¥–∂–µ–Ω–Ω—è–º
      –î–∏–Ω–∞–º—ñ—á–Ω—ñ –ø–æ—Å—Ç–∏:
      ‚ùóÔ∏è /addTypeDinamic "–Ω–∞–∑–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è" - –¥–æ–¥–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –≤ –¥–∏–Ω–∞–º—ñ—á–Ω—ñ –ø–æ—Å—Ç–∏/–ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó. –£–≤–∞–≥–∞! –ø—ñ—Å–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó —ó—ó –Ω–µ –º–æ–∂–ª–∏–≤–æ –±—É–¥–µ –≤–∏–¥–∞–ª–∏—Ç–∏.
      /makeTopDinamicPost "message id –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è" - –ø—ñ–¥–Ω—è—Ç–∏/–ø—Ä–∏–±—Ä–∞—Ç–∏ –¥–∏–Ω–∞–º—ñ—á–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —É–≤–µ—Ä—Ö, –≤–æ–Ω–æ –±—É–¥–µ –≤–∏–≤–æ–¥–∏—Ç–∏—Å—è –æ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è –∑–∞–ø—Ä–æ—Å—É –ø—É–±–ª—ñ–∫–∞—Ü—ñ–π –ø–µ–≤–Ω–æ—ó –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
      /deleteDinamicType "message id –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è" - –≤–∏–¥–∞–ª–∏—Ç–∏ –¥–∏–Ω–∞–º—ñ—á–Ω—É –ø—É–±–ª—ñ–∫–∞—Ü—ñ—é
      
      –°—Ç–∞—Ç–∏—á–Ω—ñ –ø–æ—Å—Ç–∏:
      /deleteStaticPost "message id –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è" - –≤–∏–¥–∞–ª–∏—Ç–∏ –ø–æ—Å—Ç
      ‚ùóÔ∏è/deleteStaticType "–Ω–∞–∑–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó" - *–¥–ª—è —Ç–æ–≥–æ –∞–±–∏ –ø–æ–¥–∏–≤–∏—Ç–∏—Å—è —ñ—Å–Ω—É—é—á—ñ –Ω–∞–∑–≤–∏ –≤–≤–µ–¥—ñ—Ç—å /showType. –í–∏–¥–∞–ª—è—î –∫–∞—Ç–µ–≥–æ—Ä—ñ—é —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å. –£–≤–∞–≥–∞! –ö–∞—Ç–µ–≥–æ—Ä—ñ—è –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–∞ –ª–∏—à–µ –ø—ñ—Å–ª—è –ø–æ–≤–Ω–æ–≥–æ –æ—á–∏—â–µ–Ω–Ω—è —Ü—ñ—î—ó –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –≤—ñ–¥ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.
      
      ‚ùóÔ∏è/banUser "id user" - –¥–æ–¥–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ —á–æ—Ä–Ω–∏–π —Å–ø–∏—Å–æ–∫, —Ç–∞ –∑–∞–±–ª–æ–∫—É–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞–Ω–Ω—è –±–æ—Ç–æ–º.`);
    }
    else {
      user.status = false;
      bot.sendMessage(currentText, '–¢–µ–ø–µ—Ä –≤–∏ –Ω–µ –∞–¥–º—ñ–Ω((');
    }
  }
});
bot.onText(/\/banUser (.+)/, (msg, source, match) => {
  const currentText = Number(source[1]);
  // console.log(currentText);
  if (isAdmin(msg)) {
    // console.log("before user");
    const user = getUserById(currentText);
    // console.log(user);
    user.status = null;
    bot.sendMessage(currentText, `
      –ß–µ—Ä–µ–∑ –ø–æ—Ä—É—à–µ–Ω–Ω—è –ø—Ä–∞–≤–∏–ª, —ñ–∑ –≤–∞—à–æ—ó —Å—Ç–æ—Ä–æ–Ω–∏, –º–∏ –±—É–ª–∏ –≤–∏–º—É—à–µ–Ω—ñ –¥–æ–¥–∞—Ç–∏ –≤–∞—Å –≤ —á–æ—Ä–Ω–∏–π —Å–ø–∏—Å–æ–∫()`);

  }
});

bot.onText(/\/deleteStaticPost (.+)/, (msg, source, match) => {
  const currentText = Number(source[1]);
  // console.log(currentText);
  if (isAdmin(msg)) {
    // console.log(getStaticPostById(currentText));
    const positionCurrentEl = staticPost.indexOf(getStaticPostById(currentText));


    // console.log(staticPost, positionCurrentEl);
    staticPost.splice(positionCurrentEl, 1);
    // console.log(staticPost);
  }
});
bot.onText(/\/deleteStaticType (.+)/, (msg, source, match) => {
  const currentText = source[1];
  // console.log(currentText);
  if (isAdmin(msg)) {
    const positionCurrentEl = typeStaticPost.indexOf(getStaticType(currentText));


    // console.log(staticPost, positionCurrentEl);
    typeStaticPost.splice(positionCurrentEl, 1);
    // console.log(staticPost);
  }
});

bot.onText(/\/showType/, (msg) => {
  if (isAdmin(msg)) {
    typeStaticPost.forEach(title => bot.sendMessage(getChatId(msg), title));
  }
});

bot.onText(/\/baned/, (msg) => {
  const banedUsers = Users.filter(user => user.status === null);
  bot.sendMessage(getChatId(msg), '–°–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —è–∫—ñ –º–æ–∂–ª–∏–≤–æ —î —à–∞—Ö—Ä–∞—è–º–∏:');
  banedUsers.forEach(userInfo => {
    let text = "";
    text += `\n--------------------------\n`;
    text += `\n–°–ø–∏—Å–æ–∫ –∫–æ—Ä–∏\n`;
    text += `—ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ${userInfo.name}\n`;
    text += `username –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ @${userInfo.username}\n`;
    text += `id –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ${userInfo.id}\n`;
    bot.sendMessage(getChatId(msg), text);
  });
});

bot.onText(/\/deleteDinamicType (.+)/, (msg, source, match) => {
  const currentText = Number(source[1]);
  // console.log(currentText);
  if (isAdmin(msg)) {
    const positionCurrentEl = dinamickPost.indexOf(getDinamicPostById(currentText));


    // console.log(staticPost, positionCurrentEl);
    bot.sendMessage(getChatId(msg), `–ü–æ—Å—Ç ${currentText} –≤–∏–¥–∞–ª–µ–Ω–∏—è —ñ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó ${dinamickPost[positionCurrentEl].type}`)
    dinamickPost.splice(positionCurrentEl, 1);
    // console.log(staticPost);
  }
});

bot.onText(/\/makeTopDinamicPost (.+)/, (msg, source, match) => {
  const currentText = Number(source[1]);
  // console.log(currentText);
  if (isAdmin(msg)) {
    const positionCurrentEl = dinamickPost.indexOf(getDinamicPostById(currentText));


    // console.log(staticPost, positionCurrentEl);
    if (dinamickPost[positionCurrentEl].main === true) {
      dinamickPost[positionCurrentEl].main = false;
      bot.sendMessage(getChatId(msg), `–ü–æ—Å—Ç ${source[1]} –ø—Ä–∏–±—Ä–∞–Ω–∏–π –∑ —Ç–æ–ø—É`)

    } else {
      dinamickPost[positionCurrentEl].main = true;
      bot.sendMessage(getChatId(msg), `–ü–æ—Å—Ç ${source[1]} –¥–æ–∞–¥–Ω–∏–π –≤ —Ç–æ–ø`)

    }
  }
});

bot.onText(/\/addTypeDinamic (.+)/, (msg, source, match) => {
  const currentText = source[1];
  // console.log(currentText);
  if (isAdmin(msg)) {
    typeDinamicPost.push(currentText);
    Users.forEach(user => user.notification.push([currentText, true]));
    bot.sendMessage(getChatId(msg), `–ö–∞—Ç–µ–≥–æ—Ä—ñ—è ${currentText} –¥–æ–¥–∞–Ω–∞`)
  }
});


// const getInfoCurrentNot = (meaning) => {
//   if (meaning) {
//     return '—É–≤—ñ–º–∫–Ω–µ–Ω–æ‚úÖ';
//   } else {
//     return '–≤–≤–∏–º–∫–Ω–µ–Ω–æ‚ùå';
//   }
// }

// bot.onText(/\/turnRequestShelter/, (msg) => {

//   const positionCurrentEl = Users.indexOf(getUser(msg));
//   if (Users[positionCurrentEl].subscribed.requestShelter === true) {
//     Users[positionCurrentEl].subscribed.requestShelter = false;
//     bot.sendMessage(getChatId(msg), "–í–∏ –≤–≤–∏–º–∫–Ω—É–ª–∏");

//   } else {
//     Users[positionCurrentEl].subscribed.requestShelter = true;
//     bot.sendMessage(getChatId(msg), "–í–∏ —É–≤—ñ–º–∫–Ω—É–ª–∏");

//   }
//   bot.sendMessage(getChatId(msg), "–í–∞—à—ñ —Ä–æ–∑–¥—ñ–ª–∏ —Ç—É—Ç—å üëá", getMenuBtn());

// });

// bot.onText(/\/turnOfferShelter/, (msg) => {

//   const positionCurrentEl = Users.indexOf(getUser(msg));
//   if (Users[positionCurrentEl].subscribed.offerShelter === true) {
//     Users[positionCurrentEl].subscribed.offerShelter = false;
//     bot.sendMessage(getChatId(msg), "–í–∏ –≤—ñ–¥–∫–ª—é—á–∏–ª–∏");

//   } else {
//     Users[positionCurrentEl].subscribed.offerShelter = true;
//     bot.sendMessage(getChatId(msg), "–í–∏ –≤–∫–ª—é—á–∏–ª–∏");

//   }
//   bot.sendMessage(getChatId(msg), "–í–∞—à—ñ —Ä–æ–∑–¥—ñ–ª–∏ —Ç—É—Ç—å üëá", getMenuBtn());

// });

// bot.onText(/\/turnRequestVolunteering/, (msg) => {

//   const positionCurrentEl = Users.indexOf(getUser(msg));
//   if (Users[positionCurrentEl].subscribed.requestVolunteering === true) {
//     Users[positionCurrentEl].subscribed.requestVolunteering = false;
//     bot.sendMessage(getChatId(msg), "–í–∏ –≤—ñ–¥–∫–ª—é—á–∏–ª–∏");

//   } else {
//     Users[positionCurrentEl].subscribed.requestVolunteering = true;
//     bot.sendMessage(getChatId(msg), "–í–∏ –≤–∫–ª—é—á–∏–ª–∏");

//   }
//   bot.sendMessage(getChatId(msg), "–í–∞—à—ñ —Ä–æ–∑–¥—ñ–ª–∏ —Ç—É—Ç—å üëá", getMenuBtn());

// });
// bot.onText(/\/turnOfferVolunteering/, (msg) => {

//   const positionCurrentEl = Users.indexOf(getUser(msg));
//   if (Users[positionCurrentEl].subscribed.offerVolunteering === true) {
//     Users[positionCurrentEl].subscribed.offerVolunteering = false;
//     bot.sendMessage(getChatId(msg), "–í–∏ –≤—ñ–¥–∫–ª—é—á–∏–ª–∏");

//   } else {
//     Users[positionCurrentEl].subscribed.offerVolunteering = true;
//     bot.sendMessage(getChatId(msg), "–í–∏ –≤–∫–ª—é—á–∏–ª–∏");

//   }
//   bot.sendMessage(getChatId(msg), "–í–∞—à—ñ —Ä–æ–∑–¥—ñ–ª–∏ —Ç—É—Ç—å üëá", getMenuBtn());

// });

const getAllAdimns = () => Users.filter(user => user.status === true);

bot.onText(/\/admin/, (msg) => {

  getAllAdimns().forEach(admin => bot.sendMessage(admin.id, `@${msg.from.username} –≤–∏–∫–ª–∏–∫–≤–∞—î –∞–¥–º—ñ–Ω–∞.\n –ó–≤–µ—Ä–Ω–µ–Ω–Ω—è #${num_adm}`));
  bot.sendMessage(getChatId(msg), `–ó–≤–µ—Ä–Ω–µ–Ω–Ω—è #${num_adm} –≤ –æ–±—Ä–æ–±—Ü—ñ. –û—á—ñ–∫—É–π—Ç–µ –∑–≤–æ—Ä–æ—Ç–Ω—å–æ–≥–æ –∑–≤'—è–∑–∫—É`);
  num_adm++;
});

// bot.onText(/\/infoNotification/, (msg) => {
//   bot.sendMessage(getChatId(msg), `–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è

// –í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–º–∫–Ω—É—Ç–∏ –∞–±–æ —É–≤—ñ–º–∫–Ω—É—Ç–∏ –Ω–∞–¥—Ö–æ–¥–∂–µ–Ω–Ω—è –ø–æ—Å—Ç—ñ–≤ –ø–µ–≤–Ω–æ—ó –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó —Å–∫–æ—Ä–∏—Å—Ç–∞–≤—à–∏—Å—å –Ω–∞—Å—Ç—É–ø–Ω–∏–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏:
// /turnRequestShelter - –Ω–∞–¥—Ö–æ–¥–∂–µ–Ω–Ω—è —â–æ–¥–æ –∑–∞–ø—Ä–æ–ø–æ–Ω–æ–≤–∞–Ω–æ–≥–æ –∂–∏—Ç–ª–∞. –í–∞—à –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞—Ç—É—Å: ${getInfoCurrentNot(getUser(msg).subscribed.requestShelter)}
// /turnOfferShelter - –Ω–∞–¥—Ö–æ–¥–∂–µ–Ω–Ω—è —â–æ–¥–æ –ø–æ—Ç—Ä–µ–±—É—é—á–∏—Ö –∂–∏—Ç–ª–æ. –í–∞—à –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞—Ç—É—Å: ${getInfoCurrentNot((getUser(msg).subscribed.offerShelter))}
// /turnRequestVolunteering - –Ω–∞–¥—Ö–æ–¥–∂–µ–Ω–Ω—è —â–æ–¥–æ –∑–∞–ø—Ä–æ–ø–æ–Ω–æ–≤–∞–Ω–æ—ó –¥–æ–ø–æ–º–æ–≥–∏. –í–∞—à –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞—Ç—É—Å: ${getInfoCurrentNot((getUser(msg).subscribed.requestVolunteering))}
// /turnOfferVolunteering - –Ω–∞–¥—Ö–æ–¥–∂–µ–Ω–Ω—è —â–æ–¥–æ –ø–æ—Ç—Ä–µ–±—É—é—á–∏—Ö –¥–æ–ø–æ–º–æ–≥–∏. –í–∞—à –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞—Ç—É—Å: ${getInfoCurrentNot((getUser(msg).subscribed.offerVolunteering))}`);
// });

bot.onText(/\/menu/, (msg) => {
  bot.sendMessage(getChatId(msg), `–í–∞—à—ñ —Ä–æ–∑–¥—ñ–ª–∏ —Ç—É—Ç—å üëá`, getBasicMenu(getChatId(msg)));
});
// bot.onText(/\/onAlarm/, (msg) => {
//   if (isAdmin(msg)) {
//     Users.forEach((user) => {
//       bot.sendMessage(user.id, "–£–≤–∞–≥–∞, —Ç—Ä–∏–≤–æ–≥–∞, –∑–Ω–∞–π—Ç–∏ —É–∫—Ä–∏—Ç—Ç—è!");
//     });
//   }
// });

// bot.onText(/\/offAlarm/, (msg) => {
//   if (isAdmin(msg)) {
//     Users.forEach((user) => {
//       bot.sendMessage(user.id, "–í—ñ–¥–º—ñ–Ω–∞ —Ç—Ä–∏–≤–æ–≥–∏");
//     });
//   }
// });

bot.onText(/\/showUsers/, (msg) => {
  if (isAdmin(msg)) {
    Users.forEach(user => bot.sendMessage(getChatId(msg), JSON.stringify(user)));
  }
});

bot.onText(/\/showDinPosts/, (msg) => {
  if (isAdmin(msg)) {
    dinamickPost.forEach(post => bot.sendMessage(getChatId(msg), JSON.stringify(post)));
  }
});

bot.onText(/\/showStatPost/, (msg) => {
  if (isAdmin(msg)) {
    staticPost.forEach(post => bot.sendMessage(getChatId(msg), JSON.stringify(post)));
  }
});
